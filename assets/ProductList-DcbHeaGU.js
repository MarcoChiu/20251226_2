import{r as a,M as j,j as e,e as b}from"./index-Bip9qa62.js";import{a as N}from"./productService-DOR3hITx.js";import{P as v}from"./Pagination-DhZMZKxY.js";import{a as w}from"./cartService-COaxWxCG.js";import{S as g}from"./sweetalert2.esm.all-BQxta0Da.js";import{P as y}from"./ProductCard-D3WV3ovx.js";const P=a.forwardRef((p,u)=>{const[s,x]=a.useState(null),[m,c]=a.useState(1),[h,n]=a.useState(!1),[d,t]=a.useState(""),l=a.useRef(null),i=a.useRef(null);a.useEffect(()=>{i.current=new j(l.current,{backdrop:"static"})},[]),a.useImperativeHandle(u,()=>({show:r=>{x(r),c(1),t(r.imageUrl),i.current.show()},hide:()=>{i.current.hide()}}));const f=async()=>{if(s){n(!0);try{await w(s.id,m),i.current.hide(),g.fire({icon:"success",title:"加入購物車成功",showConfirmButton:!1,timer:1500})}catch(r){g.fire({icon:"error",title:"加入購物車失敗",text:r.response?.data?.message||"發生錯誤"})}finally{n(!1)}}};return s?e.jsx("div",{id:"productUserModal",ref:l,className:"modal fade",tabIndex:"-1","aria-labelledby":"productUserModalLabel","aria-hidden":"true",children:e.jsxs("div",{className:"modal-dialog modal-lg",children:[e.jsxs("div",{className:"modal-content border-0 shadow-lg",children:[e.jsxs("div",{className:"modal-header border-bottom-0 p-4 pb-0",children:[e.jsx("span",{className:"badge bg-light text-dark fs-6",children:s.category}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>i.current.hide(),"aria-label":"Close"})]}),e.jsxs("div",{className:"modal-body p-4",children:[e.jsx("div",{className:"row g-4 mb-4",children:e.jsx("div",{className:"col-12",children:e.jsx("h2",{className:"display-6 fw-bold",children:s.title})})}),e.jsxs("div",{className:"row g-4 d-flex align-items-center",children:[e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"ratio ratio-1x1 bg-light rounded shadow-sm overflow-hidden position-relative",children:d?e.jsx("img",{src:d,className:"img-fluid object-fit-cover w-100 h-100",alt:s.title}):e.jsx("div",{className:"h-100 w-100 bg-secondary d-flex align-items-center justify-content-center",style:{minHeight:"300px"},children:e.jsx("span",{className:"text-white",children:"無圖片"})})})}),e.jsxs("div",{className:"col-md-6 d-flex flex-column",children:[e.jsxs("div",{className:"d-flex align-items-end mb-4",children:[s.origin_price!==s.price&&e.jsx("div",{className:"me-3",children:e.jsxs("small",{className:"text-muted text-decoration-line-through",children:["原價 NT$ ",s.origin_price]})}),e.jsx("div",{children:e.jsxs("h3",{className:"text-danger fw-bold mb-0",children:["NT$ ",s.price]})})]}),e.jsxs("div",{className:"p-3 bg-light rounded mb-4",children:[e.jsxs("div",{className:"d-flex align-items-center mb-3",children:[e.jsx("label",{htmlFor:"qtySelect",className:"form-label me-3 mb-0 fw-bold",children:"數量"}),e.jsx("select",{id:"qtySelect",className:"form-select w-auto",value:m,onChange:r=>c(Number(r.target.value)),children:[...Array(10)].map((r,o)=>e.jsx("option",{value:o+1,children:o+1},o+1))})]}),e.jsx("button",{className:"btn btn-primary w-100 py-2 fw-bold shadow-sm",type:"button",onClick:f,children:"加入購物車"})]}),s.imagesUrl&&s.imagesUrl.length>0&&e.jsxs("div",{className:"d-flex gap-2 overflow-auto",children:[s.imageUrl&&e.jsx("div",{className:`ratio ratio-1x1 border rounded cursor-pointer ${d===s.imageUrl?"border-primary border-2":"border-light"}`,style:{width:"80px",height:"80px",cursor:"pointer"},onClick:()=>t(s.imageUrl),children:e.jsx("img",{src:s.imageUrl,className:"img-fluid object-fit-cover",alt:"Main"})}),s.imagesUrl.map((r,o)=>r&&e.jsx("div",{className:`ratio ratio-1x1 border rounded cursor-pointer ${d===r?"border-primary border-2":"border-light"}`,style:{width:"80px",height:"80px",cursor:"pointer"},onClick:()=>t(r),children:e.jsx("img",{src:r,className:"img-fluid object-fit-cover",alt:`Thumb ${o+1}`})},o))]})]})]}),e.jsx("div",{className:"row g-4 mt-2",children:e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"fw-bold mb-2",children:"產品描述"}),e.jsx("p",{className:"text-muted",style:{lineHeight:"1.8",whiteSpace:"pre-wrap"},children:s.description})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"fw-bold mb-2",children:"商品內容"}),e.jsx("div",{className:"bg-light p-3 rounded",children:e.jsx("p",{className:"mb-0 text-dark",style:{whiteSpace:"pre-wrap"},children:s.content})})]})]})})]})]}),h&&e.jsx(b,{})]})}):e.jsx("div",{id:"productUserModal",ref:l,className:"modal fade",tabIndex:"-1","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-xl",children:e.jsx("div",{className:"modal-content"})})})}),L=()=>{const[p,u]=a.useState([]),[s,x]=a.useState({}),[m,c]=a.useState(!1),h=a.useRef(null);a.useEffect(()=>{n()},[]);const n=async(t=1)=>{c(!0);try{const l=await N(t);u(l.products),x(l.pagination),setTimeout(()=>{const i=document.querySelector(".container.mt-4");i&&i.scrollIntoView({behavior:"smooth",block:"start"})},0)}catch(l){g.fire({icon:"error",title:"取得產品失敗",text:l.response?.data?.message||"發生錯誤"})}finally{c(!1)}},d=t=>{h.current.show(t)};return e.jsxs(e.Fragment,{children:[m&&e.jsx(b,{}),e.jsxs("div",{className:"container mt-4",children:[e.jsx("div",{className:"d-flex justify-content-between mb-4",children:e.jsx("h2",{children:"產品列表"})}),e.jsx("div",{className:"row mt-4",children:p.map(t=>e.jsx("div",{className:"col-md-6 mb-6",children:e.jsx(y,{product:t,children:e.jsx("button",{type:"button",className:"btn btn-outline-primary w-100",onClick:()=>d(t),children:"詳細資料"})})},t.id))}),e.jsx(v,{currentPage:s.current_page,totalPages:s.total_pages,onPageChange:n}),e.jsx(P,{ref:h})]})]})};export{L as default};
