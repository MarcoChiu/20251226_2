import{r as t,M as p,j as e,e as j,i as u}from"./index-DVyv32AZ.js";import{p as N,g,a as y}from"./orderService-BBGVczoo.js";import{a as f,s as b}from"./sweetAlert-D4ArfHHU.js";import{P as w}from"./Pagination-nYRCMy6R.js";import{s as v}from"./scrollTo-BJ3PFdU1.js";const k=t.forwardRef((n,h)=>{const c=t.useRef(null),r=t.useRef(null),[l,i]=t.useState(null),[m,o]=t.useState(!1),x=async()=>{o(!0);try{const s=await N(l.id);r.current.hide(),f("success","付款成功"),n.onPaymentSuccess&&n.onPaymentSuccess()}catch(s){b("error","付款失敗",s.response?.data?.message||"發生錯誤")}finally{o(!1)}};return t.useEffect(()=>{r.current=new p(c.current)},[]),t.useImperativeHandle(h,()=>({show:s=>{i(s),r.current.show()},hide:()=>{r.current.hide()}})),l?e.jsx("div",{id:"orderModal",ref:c,className:"modal fade",tabIndex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true",children:e.jsxs("div",{className:"modal-dialog modal-lg modal-dialog-centered",children:[m&&e.jsx(j,{}),e.jsxs("div",{className:"modal-content border-0 shadow-lg",children:[e.jsxs("div",{className:"modal-header bg-dark text-white border-0 py-3",children:[e.jsxs("h5",{className:"modal-title d-flex align-items-center gap-2",id:"orderModalLabel",children:[e.jsx("i",{className:"bi bi-receipt"})," 訂單細節"]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>r.current.hide(),"aria-label":"Close"})]}),e.jsxs("div",{className:"modal-body p-4 bg-light",children:[e.jsxs("div",{className:"row g-4 mb-4",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"card h-100 border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-white border-bottom-0 pt-3 pb-0",children:e.jsxs("h6",{className:"card-title mb-0 fw-bold text-primary",children:[e.jsx("i",{className:"bi bi-person-fill me-2"}),"顧客資訊"]})}),e.jsx("div",{className:"card-body",children:e.jsx("table",{className:"table table-borderless table-sm mb-0",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{className:"text-secondary w-25",children:"姓名"}),e.jsx("td",{className:"fw-medium",children:l.user.name})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-secondary",children:"Email"}),e.jsx("td",{className:"fw-medium text-break",children:l.user.email})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-secondary",children:"電話"}),e.jsx("td",{className:"fw-medium",children:l.user.tel})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-secondary",children:"地址"}),e.jsx("td",{className:"fw-medium text-break",children:l.user.address})]})]})})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"card h-100 border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-white border-bottom-0 pt-3 pb-0",children:e.jsxs("h6",{className:"card-title mb-0 fw-bold text-primary",children:[e.jsx("i",{className:"bi bi-info-circle-fill me-2"}),"訂單資訊"]})}),e.jsx("div",{className:"card-body",children:e.jsx("table",{className:"table table-borderless table-sm mb-0",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{className:"text-secondary w-25",children:"訂單編號"}),e.jsx("td",{className:"fw-medium text-truncate",style:{maxWidth:"150px"},title:l.id,children:l.id})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-secondary",children:"下單時間"}),e.jsx("td",{children:new Date(l.create_at*1e3).toLocaleString()})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-secondary",children:"付款狀態"}),e.jsx("td",{children:l.is_paid?e.jsxs("span",{className:"badge bg-success-subtle text-success border border-success-subtle rounded-pill",children:[e.jsx("i",{className:"bi bi-check-circle-fill me-1"}),"已付款"]}):e.jsxs("span",{className:"badge bg-danger-subtle text-danger border border-danger-subtle rounded-pill",children:[e.jsx("i",{className:"bi bi-exclamation-circle-fill me-1"}),"未付款"]})})]}),l.is_paid&&e.jsxs("tr",{children:[e.jsx("th",{className:"text-secondary",children:"付款時間"}),e.jsx("td",{children:new Date(l.paid_date*1e3).toLocaleString()})]})]})})})]})})]}),e.jsxs("div",{className:"card border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-white border-bottom py-3",children:e.jsxs("h6",{className:"mb-0 fw-bold",children:[e.jsx("i",{className:"bi bi-cart-check-fill me-2 text-primary"}),"選購商品"]})}),e.jsxs("div",{className:"card-body p-0",children:[e.jsx("div",{className:"table-responsive d-none d-md-block",children:e.jsxs("table",{className:"table align-middle mb-0 table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{className:"ps-4 py-3",children:"商品詳情"}),e.jsx("th",{className:"text-center py-3",style:{width:"120px"},children:"數量"}),e.jsx("th",{className:"text-end pe-4 py-3",style:{width:"150px"},children:"小計"})]})}),e.jsx("tbody",{children:Object.values(l.products).map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"ps-4 py-3",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{style:{width:"70px",height:"70px",minWidth:"70px",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:`url(${s.product.imageUrl})`},className:"rounded border shadow-sm me-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium text-dark mb-1",children:s.product.title}),s.coupon&&e.jsxs("small",{className:"text-success d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-ticket-perforated-fill me-1"}),"已套用: ",s.coupon.title]})]})]})}),e.jsx("td",{className:"text-center py-3",children:e.jsxs("div",{className:"d-inline-block bg-light px-2 py-1 rounded border",children:[e.jsx("span",{className:"fw-medium",children:s.qty}),e.jsx("span",{className:"text-muted mx-1",children:"/"}),e.jsx("span",{className:"text-muted small",children:s.product.unit})]})}),e.jsxs("td",{className:"text-end pe-4 py-3 fw-bold text-primary",children:["$",s.final_total?.toLocaleString()]})]},s.id))}),e.jsx("tfoot",{className:"table-light border-top",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"2",className:"text-end py-3 fw-bold text-secondary",children:"總金額"}),e.jsx("td",{className:"text-end pe-4 py-3",children:e.jsxs("span",{className:"fs-4 fw-bold text-primary",children:["$",l.total?.toLocaleString()]})})]})})]})}),e.jsxs("div",{className:"d-md-none",children:[Object.values(l.products).map(s=>e.jsxs("div",{className:"p-3 border-bottom",children:[e.jsxs("div",{className:"d-flex mb-3",children:[e.jsx("div",{style:{width:"80px",height:"80px",minWidth:"80px",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:`url(${s.product.imageUrl})`},className:"rounded border shadow-sm me-3"}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("div",{className:"fw-bold text-dark mb-1",children:s.product.title}),s.coupon&&e.jsxs("small",{className:"text-success d-flex align-items-center mb-1",children:[e.jsx("i",{className:"bi bi-ticket-perforated-fill me-1"}),s.coupon.title]})]})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center bg-light px-3 py-1 rounded-pill border",children:[e.jsx("span",{className:"fw-bold me-1",children:s.qty}),e.jsx("span",{className:"text-muted small",children:s.product.unit})]}),e.jsxs("div",{className:"fw-bold text-primary fs-5",children:["$",s.final_total?.toLocaleString()]})]})]},s.id)),e.jsxs("div",{className:"p-3 bg-light d-flex justify-content-between align-items-center border-top",children:[e.jsx("span",{className:"fw-bold text-secondary",children:"總金額"}),e.jsxs("span",{className:"fs-3 fw-bold text-primary",children:["$",l.total?.toLocaleString()]})]})]})]})]})]}),e.jsxs("div",{className:"modal-footer border-top-0 bg-light pb-4 pe-4",children:[e.jsx("button",{type:"button",className:"btn btn-secondary px-4 rounded-pill shadow-sm",onClick:()=>r.current.hide(),children:"關閉視窗"}),!l.is_paid&&e.jsxs("button",{type:"button",className:"btn btn-primary px-4 rounded-pill shadow-sm ms-2",onClick:x,disabled:m,children:[e.jsx("i",{className:"bi bi-credit-card mx-1"}),"立即付款"]})]})]})]})}):e.jsx("div",{id:"orderModal",ref:c,className:"modal fade",tabIndex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsx("div",{className:"modal-content"})})})}),I=()=>{const[n,h]=t.useState([]),[c,r]=t.useState({}),[l,i]=t.useState(!1),m=t.useRef(null),o=u();t.useEffect(()=>{x()},[]),t.useEffect(()=>{const a=o.state?.orderId;a&&s(a)},[o.state?.orderId]);const x=async(a=1)=>{i(!0);try{const d=await g(a);h(d.orders),r(d.pagination),v()}catch(d){b("error","取得訂單列表失敗",d.response?.data?.message||"發生錯誤")}finally{i(!1)}},s=async a=>{i(!0);try{const d=await y(a);m.current.show(d.order)}catch(d){b("error","取得訂單細節失敗",d.response?.data?.message||"發生錯誤")}finally{i(!1)}};return e.jsxs(e.Fragment,{children:[l&&e.jsx(j,{}),e.jsx(k,{ref:m,onPaymentSuccess:()=>x(c.current_page)}),e.jsxs("div",{className:"container mt-4",children:[e.jsx("h2",{className:"mb-4",children:"訂單列表"}),e.jsx("div",{className:"card border-0 shadow-sm rounded-4 overflow-hidden d-none d-md-block",children:e.jsx("div",{className:"card-body p-0",children:e.jsxs("table",{className:"table table-hover align-middle mb-0",children:[e.jsx("thead",{className:"bg-light text-secondary border-bottom",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-3 ps-4",children:"訂單編號"}),e.jsx("th",{className:"py-3",children:"下單時間"}),e.jsx("th",{className:"py-3",children:"Email"}),e.jsx("th",{className:"py-3",children:"選購商品"}),e.jsx("th",{className:"py-3",children:"總金額"}),e.jsx("th",{className:"py-3",children:"付款狀態"}),e.jsx("th",{className:"py-3 pe-4 text-end",children:"操作"})]})}),e.jsx("tbody",{children:n.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"ps-4 text-secondary",children:e.jsx("span",{className:"font-monospace small",children:a.id})}),e.jsx("td",{className:"text-secondary small",children:new Date(a.create_at*1e3).toLocaleString()}),e.jsx("td",{children:e.jsx("span",{className:"text-dark fw-medium",children:a.user?.email})}),e.jsx("td",{style:{minWidth:"250px"},children:e.jsx("ul",{className:"list-unstyled mb-0",children:Object.values(a.products).map(d=>e.jsxs("li",{className:"text-secondary small d-flex align-items-center mb-1",children:[e.jsx("i",{className:"bi bi-box-seam me-2 text-primary-subtle"}),e.jsx("span",{className:"text-truncate",style:{maxWidth:"200px"},children:d.product.title}),e.jsxs("span",{className:"ms-2 badge bg-light text-secondary border",children:["x",d.qty]})]},d.id))})}),e.jsxs("td",{className:"fw-bold text-primary",children:["$",a.total]}),e.jsx("td",{children:a.is_paid?e.jsxs("span",{className:"badge bg-success-subtle text-success border border-success-subtle rounded-pill px-3",children:[e.jsx("i",{className:"bi bi-check-circle-fill me-1"}),"已付款"]}):e.jsxs("span",{className:"badge bg-danger-subtle text-danger border border-danger-subtle rounded-pill px-3",children:[e.jsx("i",{className:"bi bi-exclamation-circle-fill me-1"}),"未付款"]})}),e.jsx("td",{className:"pe-4 text-end",children:e.jsx("button",{type:"button",className:"btn btn-primary btn-sm rounded-pill px-3",onClick:()=>s(a.id),children:"查看細節"})})]},a.id))})]})})}),e.jsx("div",{className:"d-md-none",children:n.map(a=>e.jsxs("div",{className:"card mb-4 shadow-sm border-0 rounded-3",children:[e.jsxs("div",{className:"card-header bg-white py-3 border-0",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("span",{className:"badge bg-secondary-subtle text-secondary-emphasis rounded-pill px-3",children:["訂單編號: ",a.id?.substring(0,10),"..."]}),a.is_paid?e.jsx("span",{className:"badge bg-success-subtle text-success rounded-pill",children:"已付款"}):e.jsx("span",{className:"badge bg-danger-subtle text-danger rounded-pill",children:"未付款"})]}),e.jsx("div",{className:"text-muted small",children:new Date(a.create_at*1e3).toLocaleString()})]}),e.jsxs("div",{className:"card-body pt-0",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"text-muted small form-label mb-1",children:"Email"}),e.jsx("div",{className:"text-break fw-medium",children:a.user?.email})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"text-muted small form-label mb-1",children:"選購商品"}),e.jsx("div",{className:"bg-light p-3 rounded-3",children:e.jsx("ul",{className:"list-unstyled mb-0",children:Object.values(a.products).map(d=>e.jsxs("li",{className:"d-flex justify-content-between align-items-center mb-2 last:mb-0",children:[e.jsx("span",{className:"text-truncate text-secondary",style:{maxWidth:"70%"},children:d.product.title}),e.jsxs("span",{className:"text-nowrap fw-medium",children:["x ",d.qty]})]},d.id))})})]}),e.jsx("div",{className:"border-top pt-3 mt-2",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("small",{className:"text-muted d-block mb-1",children:"總金額"}),e.jsxs("div",{className:"fs-4 fw-bold text-primary",children:["$",a.total]})]}),e.jsx("button",{type:"button",className:"btn btn-primary px-4 rounded-pill",onClick:()=>s(a.id),children:"查看細節"})]})})]})]},a.id))}),e.jsx(w,{currentPage:c.current_page,totalPages:c.total_pages,onPageChange:x})]})]})};export{I as default};
