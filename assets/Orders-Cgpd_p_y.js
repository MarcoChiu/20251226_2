import{r as d,M as b,j as e,e as j}from"./index-_groiTb1.js";import{p,g as u,a as N}from"./orderService-Cap-JBbG.js";import{a as g,s as h}from"./sweetAlert-BB8DS3-L.js";import{P as y}from"./Pagination-Dr2c56Uk.js";const f=d.forwardRef((i,x)=>{const c=d.useRef(null),t=d.useRef(null),[a,r]=d.useState(null),[n,m]=d.useState(!1),o=async()=>{m(!0);try{const s=await p(a.id);g("success","付款成功"),r(l=>({...l,is_paid:!0,paid_date:Math.floor(Date.now()/1e3)})),i.onPaymentSuccess&&i.onPaymentSuccess()}catch(s){h("error","付款失敗",s.response?.data?.message||"發生錯誤")}finally{m(!1)}};return d.useEffect(()=>{t.current=new b(c.current)},[]),d.useImperativeHandle(x,()=>({show:s=>{r(s),t.current.show()},hide:()=>{t.current.hide()}})),a?e.jsx("div",{id:"orderModal",ref:c,className:"modal fade",tabIndex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered",children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",children:[e.jsxs("div",{className:"modal-header bg-dark text-white border-0 py-3",children:[e.jsxs("h5",{className:"modal-title d-flex align-items-center gap-2",id:"orderModalLabel",children:[e.jsx("i",{className:"bi bi-receipt"})," 訂單細節"]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>t.current.hide(),"aria-label":"Close"})]}),e.jsxs("div",{className:"modal-body p-4 bg-light",children:[e.jsxs("div",{className:"row g-4 mb-4",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"card h-100 border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-white border-bottom-0 pt-3 pb-0",children:e.jsxs("h6",{className:"card-title mb-0 fw-bold text-primary",children:[e.jsx("i",{className:"bi bi-person-fill me-2"}),"顧客資訊"]})}),e.jsx("div",{className:"card-body",children:e.jsx("table",{className:"table table-borderless table-sm mb-0",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{className:"text-secondary w-25",children:"姓名"}),e.jsx("td",{className:"fw-medium",children:a.user.name})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-secondary",children:"Email"}),e.jsx("td",{className:"fw-medium text-break",children:a.user.email})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-secondary",children:"電話"}),e.jsx("td",{className:"fw-medium",children:a.user.tel})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-secondary",children:"地址"}),e.jsx("td",{className:"fw-medium text-break",children:a.user.address})]})]})})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"card h-100 border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-white border-bottom-0 pt-3 pb-0",children:e.jsxs("h6",{className:"card-title mb-0 fw-bold text-primary",children:[e.jsx("i",{className:"bi bi-info-circle-fill me-2"}),"訂單資訊"]})}),e.jsx("div",{className:"card-body",children:e.jsx("table",{className:"table table-borderless table-sm mb-0",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{className:"text-secondary w-25",children:"訂單編號"}),e.jsx("td",{className:"fw-medium text-truncate",style:{maxWidth:"150px"},title:a.id,children:a.id})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-secondary",children:"下單時間"}),e.jsx("td",{children:new Date(a.create_at*1e3).toLocaleString()})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-secondary",children:"付款狀態"}),e.jsx("td",{children:a.is_paid?e.jsxs("span",{className:"badge bg-success-subtle text-success border border-success-subtle rounded-pill",children:[e.jsx("i",{className:"bi bi-check-circle-fill me-1"}),"已付款"]}):e.jsxs("span",{className:"badge bg-danger-subtle text-danger border border-danger-subtle rounded-pill",children:[e.jsx("i",{className:"bi bi-exclamation-circle-fill me-1"}),"未付款"]})})]}),a.is_paid&&e.jsxs("tr",{children:[e.jsx("th",{className:"text-secondary",children:"付款時間"}),e.jsx("td",{children:new Date(a.paid_date*1e3).toLocaleString()})]})]})})})]})})]}),e.jsxs("div",{className:"card border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-white border-bottom py-3",children:e.jsxs("h6",{className:"mb-0 fw-bold",children:[e.jsx("i",{className:"bi bi-cart-check-fill me-2 text-primary"}),"選購商品"]})}),e.jsxs("div",{className:"card-body p-0",children:[e.jsx("div",{className:"table-responsive d-none d-md-block",children:e.jsxs("table",{className:"table align-middle mb-0 table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{className:"ps-4 py-3",children:"商品詳情"}),e.jsx("th",{className:"text-center py-3",style:{width:"120px"},children:"數量"}),e.jsx("th",{className:"text-end pe-4 py-3",style:{width:"150px"},children:"小計"})]})}),e.jsx("tbody",{children:Object.values(a.products).map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"ps-4 py-3",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{style:{width:"70px",height:"70px",minWidth:"70px",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:`url(${s.product.imageUrl})`},className:"rounded border shadow-sm me-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium text-dark mb-1",children:s.product.title}),s.coupon&&e.jsxs("small",{className:"text-success d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-ticket-perforated-fill me-1"}),"已套用: ",s.coupon.title]})]})]})}),e.jsx("td",{className:"text-center py-3",children:e.jsxs("div",{className:"d-inline-block bg-light px-2 py-1 rounded border",children:[e.jsx("span",{className:"fw-medium",children:s.qty}),e.jsx("span",{className:"text-muted mx-1",children:"/"}),e.jsx("span",{className:"text-muted small",children:s.product.unit})]})}),e.jsxs("td",{className:"text-end pe-4 py-3 fw-bold text-primary",children:["$",s.final_total?.toLocaleString()]})]},s.id))}),e.jsx("tfoot",{className:"table-light border-top",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"2",className:"text-end py-3 fw-bold text-secondary",children:"總金額"}),e.jsx("td",{className:"text-end pe-4 py-3",children:e.jsxs("span",{className:"fs-4 fw-bold text-primary",children:["$",a.total?.toLocaleString()]})})]})})]})}),e.jsxs("div",{className:"d-md-none",children:[Object.values(a.products).map(s=>e.jsxs("div",{className:"p-3 border-bottom",children:[e.jsxs("div",{className:"d-flex mb-3",children:[e.jsx("div",{style:{width:"80px",height:"80px",minWidth:"80px",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:`url(${s.product.imageUrl})`},className:"rounded border shadow-sm me-3"}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("div",{className:"fw-bold text-dark mb-1",children:s.product.title}),s.coupon&&e.jsxs("small",{className:"text-success d-flex align-items-center mb-1",children:[e.jsx("i",{className:"bi bi-ticket-perforated-fill me-1"}),s.coupon.title]})]})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center bg-light px-3 py-1 rounded-pill border",children:[e.jsx("span",{className:"fw-bold me-1",children:s.qty}),e.jsx("span",{className:"text-muted small",children:s.product.unit})]}),e.jsxs("div",{className:"fw-bold text-primary fs-5",children:["$",s.final_total?.toLocaleString()]})]})]},s.id)),e.jsxs("div",{className:"p-3 bg-light d-flex justify-content-between align-items-center border-top",children:[e.jsx("span",{className:"fw-bold text-secondary",children:"總金額"}),e.jsxs("span",{className:"fs-3 fw-bold text-primary",children:["$",a.total?.toLocaleString()]})]})]})]})]})]}),e.jsxs("div",{className:"modal-footer border-top-0 bg-light pb-4 pe-4",children:[e.jsx("button",{type:"button",className:"btn btn-secondary px-4 rounded-pill shadow-sm",onClick:()=>t.current.hide(),children:"關閉視窗"}),!a.is_paid&&e.jsx("button",{type:"button",className:"btn btn-primary px-4 rounded-pill shadow-sm ms-2",onClick:o,disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"處理中..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-credit-card mx-1"}),"立即付款"]})})]})]})})}):e.jsx("div",{id:"orderModal",ref:c,className:"modal fade",tabIndex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsx("div",{className:"modal-content"})})})}),L=()=>{const[i,x]=d.useState([]),[c,t]=d.useState({}),[a,r]=d.useState(!1),n=d.useRef(null);d.useEffect(()=>{m()},[]);const m=async(s=1)=>{r(!0);try{const l=await u(s);x(l.orders),t(l.pagination)}catch(l){h("error","取得訂單列表失敗",l.response?.data?.message||"發生錯誤")}finally{r(!1)}},o=async s=>{r(!0);try{const l=await N(s);n.current.show(l.order)}catch(l){h("error","取得訂單細節失敗",l.response?.data?.message||"發生錯誤")}finally{r(!1)}};return e.jsxs(e.Fragment,{children:[a&&e.jsx(j,{}),e.jsx(f,{ref:n}),e.jsxs("div",{className:"container mt-4",children:[e.jsx("h2",{className:"mb-4",children:"訂單列表"}),e.jsx("div",{className:"card border-0 shadow-sm rounded-4 overflow-hidden d-none d-md-block",children:e.jsx("div",{className:"card-body p-0",children:e.jsxs("table",{className:"table table-hover align-middle mb-0",children:[e.jsx("thead",{className:"bg-light text-secondary border-bottom",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-3 ps-4",children:"訂單編號"}),e.jsx("th",{className:"py-3",children:"下單時間"}),e.jsx("th",{className:"py-3",children:"Email"}),e.jsx("th",{className:"py-3",children:"選購商品"}),e.jsx("th",{className:"py-3",children:"總金額"}),e.jsx("th",{className:"py-3",children:"付款狀態"}),e.jsx("th",{className:"py-3 pe-4 text-end",children:"操作"})]})}),e.jsx("tbody",{children:i.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"ps-4 text-secondary",children:e.jsx("span",{className:"font-monospace small",children:s.id})}),e.jsx("td",{className:"text-secondary small",children:new Date(s.create_at*1e3).toLocaleString()}),e.jsx("td",{children:e.jsx("span",{className:"text-dark fw-medium",children:s.user?.email})}),e.jsx("td",{style:{minWidth:"250px"},children:e.jsx("ul",{className:"list-unstyled mb-0",children:Object.values(s.products).map(l=>e.jsxs("li",{className:"text-secondary small d-flex align-items-center mb-1",children:[e.jsx("i",{className:"bi bi-box-seam me-2 text-primary-subtle"}),e.jsx("span",{className:"text-truncate",style:{maxWidth:"200px"},children:l.product.title}),e.jsxs("span",{className:"ms-2 badge bg-light text-secondary border",children:["x",l.qty]})]},l.id))})}),e.jsxs("td",{className:"fw-bold text-primary",children:["$",s.total]}),e.jsx("td",{children:s.is_paid?e.jsxs("span",{className:"badge bg-success-subtle text-success border border-success-subtle rounded-pill px-3",children:[e.jsx("i",{className:"bi bi-check-circle-fill me-1"}),"已付款"]}):e.jsxs("span",{className:"badge bg-danger-subtle text-danger border border-danger-subtle rounded-pill px-3",children:[e.jsx("i",{className:"bi bi-exclamation-circle-fill me-1"}),"未付款"]})}),e.jsx("td",{className:"pe-4 text-end",children:e.jsx("button",{type:"button",className:"btn btn-primary btn-sm rounded-pill px-3",onClick:()=>o(s.id),children:"查看細節"})})]},s.id))})]})})}),e.jsx("div",{className:"d-md-none",children:i.map(s=>e.jsxs("div",{className:"card mb-4 shadow-sm border-0 rounded-3",children:[e.jsxs("div",{className:"card-header bg-white py-3 border-0",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("span",{className:"badge bg-secondary-subtle text-secondary-emphasis rounded-pill px-3",children:["訂單編號: ",s.id?.substring(0,10),"..."]}),s.is_paid?e.jsx("span",{className:"badge bg-success-subtle text-success rounded-pill",children:"已付款"}):e.jsx("span",{className:"badge bg-danger-subtle text-danger rounded-pill",children:"未付款"})]}),e.jsx("div",{className:"text-muted small",children:new Date(s.create_at*1e3).toLocaleString()})]}),e.jsxs("div",{className:"card-body pt-0",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"text-muted small form-label mb-1",children:"Email"}),e.jsx("div",{className:"text-break fw-medium",children:s.user?.email})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"text-muted small form-label mb-1",children:"選購商品"}),e.jsx("div",{className:"bg-light p-3 rounded-3",children:e.jsx("ul",{className:"list-unstyled mb-0",children:Object.values(s.products).map(l=>e.jsxs("li",{className:"d-flex justify-content-between align-items-center mb-2 last:mb-0",children:[e.jsx("span",{className:"text-truncate text-secondary",style:{maxWidth:"70%"},children:l.product.title}),e.jsxs("span",{className:"text-nowrap fw-medium",children:["x ",l.qty]})]},l.id))})})]}),e.jsx("div",{className:"border-top pt-3 mt-2",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("small",{className:"text-muted d-block mb-1",children:"總金額"}),e.jsxs("div",{className:"fs-4 fw-bold text-primary",children:["$",s.total]})]}),e.jsx("button",{type:"button",className:"btn btn-primary px-4 rounded-pill",onClick:()=>o(s.id),children:"查看細節"})]})})]})]},s.id))}),e.jsx(y,{currentPage:c.current_page,totalPages:c.total_pages,onPageChange:m})]})]})};export{L as default};
