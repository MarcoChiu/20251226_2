import{r as a,h as v,u as w,M as y,j as e,e as b}from"./index-Ms3byUyv.js";import{a as P}from"./productService-CbtoD6Q_.js";import{P as U}from"./Pagination-BY_8l3xM.js";import{a as C}from"./cartService-DvWppUJV.js";import{s as g,a as S}from"./sweetAlert-BB8DS3-L.js";import{P as I}from"./ProductCard-DOG5EtYM.js";import{s as M}from"./scrollTo-BJ3PFdU1.js";const k=a.forwardRef((p,u)=>{const[s,x]=a.useState(null),[m,o]=a.useState(1),[h,n]=a.useState(!1),[i,t]=a.useState(""),l=a.useRef(null),d=a.useRef(null),{isAuth:j}=v(),f=w();a.useEffect(()=>{d.current=new y(l.current,{backdrop:"static"})},[]),a.useImperativeHandle(u,()=>({show:r=>{x(r),o(1),t(r.imageUrl),d.current.show()},hide:()=>{d.current.hide()}}));const N=async()=>{if(!j){g("warning","請先登入","需登入會員才能加入購物車"),d.current.hide(),f("/login");return}if(s){n(!0);try{await C(s.id,m),d.current.hide(),S("success","加入購物車成功")}catch(r){g("error","加入購物車失敗",r.response?.data?.message||"發生錯誤")}finally{n(!1)}}};return s?e.jsx("div",{id:"productUserModal",ref:l,className:"modal fade",tabIndex:"-1","aria-labelledby":"productUserModalLabel","aria-hidden":"true",children:e.jsxs("div",{className:"modal-dialog modal-lg",children:[e.jsxs("div",{className:"modal-content border-0 shadow-lg",children:[e.jsxs("div",{className:"modal-header border-bottom-0 p-4 pb-0",children:[e.jsx("span",{className:"badge bg-light text-dark fs-6",children:s.category}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>d.current.hide(),"aria-label":"Close"})]}),e.jsxs("div",{className:"modal-body p-4",children:[e.jsx("div",{className:"row g-4 mb-4",children:e.jsx("div",{className:"col-12",children:e.jsx("h2",{className:"display-6 fw-bold",children:s.title})})}),e.jsxs("div",{className:"row g-4 d-flex align-items-center",children:[e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"ratio ratio-1x1 bg-light rounded shadow-sm overflow-hidden position-relative",children:i?e.jsx("img",{src:i,className:"img-fluid object-fit-cover w-100 h-100",alt:s.title}):e.jsx("div",{className:"h-100 w-100 bg-secondary d-flex align-items-center justify-content-center",style:{minHeight:"300px"},children:e.jsx("span",{className:"text-white",children:"無圖片"})})})}),e.jsxs("div",{className:"col-md-6 d-flex flex-column",children:[e.jsxs("div",{className:"d-flex align-items-end mb-4",children:[s.origin_price!==s.price&&e.jsx("div",{className:"me-3",children:e.jsxs("small",{className:"text-muted text-decoration-line-through",children:["原價 NT$ ",s.origin_price]})}),e.jsx("div",{children:e.jsxs("h3",{className:"text-danger fw-bold mb-0",children:["NT$ ",s.price]})})]}),e.jsxs("div",{className:"p-3 bg-light rounded mb-4",children:[e.jsxs("div",{className:"d-flex align-items-center mb-3",children:[e.jsx("label",{htmlFor:"qtySelect",className:"form-label me-3 mb-0 fw-bold",children:"數量"}),e.jsx("select",{id:"qtySelect",className:"form-select w-auto",value:m,onChange:r=>o(Number(r.target.value)),children:[...Array(20)].map((r,c)=>e.jsx("option",{value:c+1,children:c+1},c+1))})]}),e.jsx("button",{className:"btn btn-primary w-100 py-2 fw-bold shadow-sm",type:"button",onClick:N,children:"加入購物車"})]}),s.imagesUrl&&s.imagesUrl.length>0&&e.jsxs("div",{className:"d-flex gap-2 overflow-auto",children:[s.imageUrl&&e.jsx("div",{className:`ratio ratio-1x1 border rounded cursor-pointer ${i===s.imageUrl?"border-primary border-2":"border-light"}`,style:{width:"80px",height:"80px",cursor:"pointer"},onClick:()=>t(s.imageUrl),children:e.jsx("img",{src:s.imageUrl,className:"img-fluid object-fit-cover",alt:"Main"})}),s.imagesUrl.map((r,c)=>r&&e.jsx("div",{className:`ratio ratio-1x1 border rounded cursor-pointer ${i===r?"border-primary border-2":"border-light"}`,style:{width:"80px",height:"80px",cursor:"pointer"},onClick:()=>t(r),children:e.jsx("img",{src:r,className:"img-fluid object-fit-cover",alt:`Thumb ${c+1}`})},c))]})]})]}),e.jsx("div",{className:"row g-4 mt-2",children:e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"fw-bold mb-2",children:"產品描述"}),e.jsx("p",{className:"text-muted",style:{lineHeight:"1.8",whiteSpace:"pre-wrap"},children:s.description})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"fw-bold mb-2",children:"商品內容"}),e.jsx("div",{className:"bg-light p-3 rounded",children:e.jsx("p",{className:"mb-0 text-dark",style:{whiteSpace:"pre-wrap"},children:s.content})})]})]})})]})]}),h&&e.jsx(b,{})]})}):e.jsx("div",{id:"productUserModal",ref:l,className:"modal fade",tabIndex:"-1","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-xl",children:e.jsx("div",{className:"modal-content"})})})}),q=()=>{const[p,u]=a.useState([]),[s,x]=a.useState({}),[m,o]=a.useState(!1),h=a.useRef(null);a.useEffect(()=>{n()},[]);const n=async(t=1)=>{o(!0);try{const l=await P(t);u(l.products),x(l.pagination),M()}catch(l){g("error","取得產品失敗",l.response?.data?.message||"發生錯誤")}finally{o(!1)}},i=t=>{h.current.show(t)};return e.jsxs(e.Fragment,{children:[m&&e.jsx(b,{}),e.jsxs("div",{className:"container mt-4",children:[e.jsx("div",{className:"d-flex justify-content-between mb-4",children:e.jsx("h2",{children:"產品列表"})}),e.jsx("div",{className:"row mt-4",children:p.map(t=>e.jsx("div",{className:"col-md-6 mb-6",children:e.jsx(I,{product:t,children:e.jsx("button",{type:"button",className:"btn btn-outline-primary w-100",onClick:()=>i(t),children:"詳細資料"})})},t.id))}),e.jsx(U,{currentPage:s.current_page,totalPages:s.total_pages,onPageChange:n}),e.jsx(k,{ref:h})]})]})};export{q as default};
