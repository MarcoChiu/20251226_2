import{r as m,u as k,j as e,e as $}from"./index-DL9Ij4oc.js";import{u as C}from"./index.esm-DZzXM8-u.js";import{g as q,c as S,b as _,u as F}from"./cartService-CIDGgxYw.js";import{c as E}from"./orderService-DgJbSvNq.js";import{s as c,a as x}from"./sweetAlert-D4ArfHHU.js";import{s as I}from"./scrollTo-BJ3PFdU1.js";const T=()=>{const[a,j]=m.useState({}),[p,l]=m.useState(!1),b=k(),{register:r,handleSubmit:N,formState:{errors:t},reset:g}=C();m.useEffect(()=>{d()},[]);const d=async()=>{l(!0);try{const s=await q();j(s.data),I()}catch(s){c("error","取得購物車失敗",s.response?.data?.message||"發生錯誤")}finally{l(!1)}},i=async(s,n)=>{l(!0);try{await F(s.id,s.product_id,n),d()}catch(o){c("error","更新購物車失敗",o.response?.data?.message||"發生錯誤"),l(!1)}},h=async s=>{l(!0);try{await _(s),d(),x("success","已移除商品")}catch(n){c("error","移除商品失敗",n.response?.data?.message||"發生錯誤"),l(!1)}},f=async()=>{l(!0);try{await S(),d(),x("success","已清空購物車")}catch(s){c("error","清空購物車失敗",s.response?.data?.message||"發生錯誤"),l(!1)}},y=async s=>{l(!0);const{message:n,...o}=s,v={user:o,message:n};try{const w=(await E(v))?.orderId;x("success","訂單建立成功"),g(),b("/week5/orders",{state:{orderId:w}})}catch(u){c("error","建立訂單失敗",u.response?.data?.message||"發生錯誤")}finally{l(!1)}};return e.jsxs(e.Fragment,{children:[p&&e.jsx($,{}),e.jsxs("div",{className:"container mt-4",children:[e.jsx("div",{className:"d-flex justify-content-between mb-4",children:e.jsx("h2",{children:"購物車列表"})}),a.carts&&a.carts.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"text-end mb-3",children:e.jsx("button",{className:"btn btn-outline-danger",onClick:f,children:"清空購物車"})}),e.jsx("div",{className:"table-responsive d-none d-md-block",children:e.jsxs("table",{className:"table align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{children:"圖片"}),e.jsx("th",{children:"品名"}),e.jsx("th",{style:{width:"150px"},children:"數量/單位"}),e.jsx("th",{className:"text-end",children:"單價"})]})}),e.jsx("tbody",{children:a.carts.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>h(s.id),children:"x"})}),e.jsx("td",{children:e.jsx("div",{style:{width:"80px",height:"80px",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:`url(${s.product.imageUrl||""})`},className:"rounded bg-light border",children:!s.product.imageUrl&&e.jsx("span",{className:"d-flex w-100 h-100 justify-content-center align-items-center text-secondary small",children:"無圖"})})}),e.jsxs("td",{children:[e.jsx("span",{className:"fw-bold",children:s.product.title}),s.coupon&&e.jsxs("div",{className:"text-success small",children:["已套用優惠券：",s.coupon.title]})]}),e.jsx("td",{children:e.jsxs("div",{className:"input-group input-group-sm",children:[e.jsx("button",{className:"btn btn-outline-secondary",type:"button",onClick:()=>i(s,s.qty-1),disabled:s.qty===1,children:"-"}),e.jsx("input",{type:"number",className:"form-control text-center p-0",value:s.qty,readOnly:!0,style:{maxWidth:"50px"}}),e.jsx("button",{className:"btn btn-outline-secondary",type:"button",onClick:()=>i(s,s.qty+1),children:"+"}),e.jsx("span",{className:"input-group-text",id:"basic-addon2",children:s.product.unit})]})}),e.jsx("td",{className:"text-end",children:s.final_total!==s.total?e.jsxs(e.Fragment,{children:[e.jsxs("small",{className:"text-muted text-decoration-line-through",children:["$",s.total]}),e.jsx("br",{}),e.jsx("small",{className:"text-success",children:"折扣價："}),"$",s.final_total]}):`$${s.total}`})]},s.id))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-end",children:"總計"}),e.jsxs("td",{className:"text-end",children:["$",a.total]})]}),a.final_total!==a.total&&e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-end text-success",children:"折扣價"}),e.jsxs("td",{className:"text-end text-success",children:["$",a.final_total]})]})]})]})}),e.jsxs("div",{className:"d-md-none",children:[a.carts.map(s=>e.jsx("div",{className:"card mb-3 shadow-sm border-0",children:e.jsxs("div",{className:"row g-0",children:[e.jsx("div",{className:"col-4 position-relative",children:e.jsx("div",{style:{width:"100%",height:"100%",minHeight:"120px",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:`url(${s.product.imageUrl||""})`},className:"rounded-start h-100 bg-light",children:!s.product.imageUrl&&e.jsx("span",{className:"d-flex position-absolute top-50 start-50 translate-middle text-secondary small",children:"無圖"})})}),e.jsx("div",{className:"col-8",children:e.jsxs("div",{className:"card-body py-2 px-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsx("span",{className:"card-title fw-bold mb-0",style:{marginRight:"24px",whiteSpace:"normal",wordBreak:"break-word",display:"block"},children:s.product.title}),e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm p-1 lh-1 position-absolute top-0 end-0 m-2",onClick:()=>h(s.id),children:e.jsx("small",{children:"x"})})]}),s.coupon&&e.jsxs("div",{className:"text-success small mb-2",children:["已套用優惠券：",s.coupon.title]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-end",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"input-group input-group-sm me-2",style:{width:"auto"},children:[e.jsx("button",{className:"btn btn-outline-secondary",type:"button",onClick:()=>i(s,s.qty-1),disabled:s.qty===1,style:{padding:"0.25rem 0.5rem"},children:"-"}),e.jsx("input",{type:"number",className:"form-control text-center p-0",value:s.qty,readOnly:!0,style:{width:"50px",minWidth:"40px"}}),e.jsx("button",{className:"btn btn-outline-secondary",type:"button",onClick:()=>i(s,s.qty+1),style:{padding:"0.25rem 0.5rem"},children:"+"})]}),e.jsx("span",{className:"small text-muted text-nowrap",children:s.product.unit})]}),e.jsx("div",{className:"text-end",children:s.final_total!==s.total?e.jsxs(e.Fragment,{children:[e.jsxs("small",{className:"text-muted text-decoration-line-through d-block",children:["$",s.total]}),e.jsxs("span",{className:"text-success fw-bold",children:["$",s.final_total]})]}):e.jsxs("span",{className:"fw-bold fs-5",children:["$",s.total]})})]})]})})]})},s.id)),e.jsx("div",{className:"card shadow-sm border-0",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("span",{className:"h5 mb-0",children:"總計"}),e.jsxs("span",{className:"h5 mb-0",children:["$",a.total]})]}),a.final_total!==a.total&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center text-success",children:[e.jsx("span",{children:"折扣價"}),e.jsxs("span",{className:"fw-bold",children:["$",a.final_total]})]})]})})]}),e.jsx("div",{className:"card shadow-sm border-0 mt-5 mb-5",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h3",{className:"card-title text-center mb-4",children:"填寫訂購資訊"}),e.jsxs("form",{onSubmit:N(y),children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"email",className:"form-label",children:"Email"}),e.jsx("input",{type:"email",className:`form-control ${t.email?"is-invalid":""}`,id:"email",placeholder:"請輸入 Email",...r("email",{required:"Email 為必填",pattern:{value:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"Email 格式不正確"}})}),t.email&&e.jsx("div",{className:"invalid-feedback",children:t.email.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"name",className:"form-label",children:"收件人姓名"}),e.jsx("input",{type:"text",className:`form-control ${t.name?"is-invalid":""}`,id:"name",placeholder:"請輸入姓名",...r("name",{required:"姓名為必填"})}),t.name&&e.jsx("div",{className:"invalid-feedback",children:t.name.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"tel",className:"form-label",children:"收件人電話"}),e.jsx("input",{type:"tel",className:`form-control ${t.tel?"is-invalid":""}`,id:"tel",placeholder:"請輸入電話",...r("tel",{required:"電話為必填",minLength:{value:9,message:"電話號碼需超過 9 碼"},pattern:{value:/^09\d{8}$/,message:"請輸入有效的台灣手機號碼 (09xxxxxxxx)"}})}),t.tel&&e.jsx("div",{className:"invalid-feedback",children:t.tel.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"address",className:"form-label",children:"收件人地址"}),e.jsx("input",{type:"text",className:`form-control ${t.address?"is-invalid":""}`,id:"address",placeholder:"請輸入地址",...r("address",{required:"地址為必填"})}),t.address&&e.jsx("div",{className:"invalid-feedback",children:t.address.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"message",className:"form-label",children:"留言"}),e.jsx("textarea",{className:"form-control",id:"message",rows:"3",placeholder:"如果有什麼要告訴我們的...",...r("message")})]}),e.jsx("div",{className:"text-end",children:e.jsx("button",{type:"submit",className:"btn btn-danger btn-lg px-5",children:"送出訂單"})})]})]})})]}):e.jsx("div",{className:"alert alert-secondary text-center",children:"購物車內目前沒有商品"})]})]})};export{T as default};
