import{r as d,j as s,e as u}from"./index-o8LrowzA.js";import{g as j,c as p,b,u as g}from"./cartService-CMcpY9fC.js";import{S as r}from"./sweetalert2.esm.all-BQxta0Da.js";const y=()=>{const[t,x]=d.useState({}),[h,n]=d.useState(!1);d.useEffect(()=>{c()},[]);const c=async()=>{n(!0);try{const e=await j();x(e.data)}catch(e){r.fire({icon:"error",title:"取得購物車失敗",text:e.response?.data?.message||"發生錯誤"})}finally{n(!1)}},i=async(e,a)=>{n(!0);try{await g(e.id,e.product_id,a),c()}catch(l){r.fire({icon:"error",title:"更新購物車失敗",text:l.response?.data?.message||"發生錯誤"}),n(!1)}},o=async e=>{n(!0);try{await b(e),c(),r.fire({icon:"success",title:"已移除商品",showConfirmButton:!1,timer:1500})}catch(a){r.fire({icon:"error",title:"移除商品失敗",text:a.response?.data?.message||"發生錯誤"}),n(!1)}},m=async()=>{n(!0);try{await p(),c(),r.fire({icon:"success",title:"已清空購物車",showConfirmButton:!1,timer:1500})}catch(e){r.fire({icon:"error",title:"清空購物車失敗",text:e.response?.data?.message||"發生錯誤"}),n(!1)}};return s.jsxs(s.Fragment,{children:[h&&s.jsx(u,{}),s.jsxs("div",{className:"container mt-4",children:[s.jsx("div",{className:"d-flex justify-content-between mb-4",children:s.jsx("h2",{children:"購物車列表"})}),t.carts&&t.carts.length>0?s.jsxs("div",{children:[s.jsx("div",{className:"text-end mb-3",children:s.jsx("button",{className:"btn btn-outline-danger",onClick:m,children:"清空購物車"})}),s.jsx("div",{className:"table-responsive d-none d-md-block",children:s.jsxs("table",{className:"table align-middle",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{}),s.jsx("th",{children:"圖片"}),s.jsx("th",{children:"品名"}),s.jsx("th",{style:{width:"150px"},children:"數量/單位"}),s.jsx("th",{className:"text-end",children:"單價"})]})}),s.jsx("tbody",{children:t.carts.map(e=>s.jsxs("tr",{children:[s.jsx("td",{children:s.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>o(e.id),children:"x"})}),s.jsx("td",{children:s.jsx("div",{style:{width:"80px",height:"80px",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:`url(${e.product.imageUrl||""})`},className:"rounded bg-light border",children:!e.product.imageUrl&&s.jsx("span",{className:"d-flex w-100 h-100 justify-content-center align-items-center text-secondary small",children:"無圖"})})}),s.jsxs("td",{children:[e.product.title,e.coupon&&s.jsxs("div",{className:"text-success small",children:["已套用優惠券：",e.coupon.title]})]}),s.jsx("td",{children:s.jsxs("div",{className:"input-group input-group-sm",children:[s.jsx("select",{className:"form-select",value:e.qty,onChange:a=>i(e,Number(a.target.value)),children:[...Array(20)].map((a,l)=>s.jsx("option",{value:l+1,children:l+1},l+1))}),s.jsx("span",{className:"input-group-text",id:"basic-addon2",children:e.product.unit})]})}),s.jsx("td",{className:"text-end",children:e.final_total!==e.total?s.jsxs(s.Fragment,{children:[s.jsxs("small",{className:"text-muted text-decoration-line-through",children:["$",e.total]}),s.jsx("br",{}),s.jsx("small",{className:"text-success",children:"折扣價："}),"$",e.final_total]}):`$${e.total}`})]},e.id))}),s.jsxs("tfoot",{children:[s.jsxs("tr",{children:[s.jsx("td",{colSpan:"4",className:"text-end",children:"總計"}),s.jsxs("td",{className:"text-end",children:["$",t.total]})]}),t.final_total!==t.total&&s.jsxs("tr",{children:[s.jsx("td",{colSpan:"4",className:"text-end text-success",children:"折扣價"}),s.jsxs("td",{className:"text-end text-success",children:["$",t.final_total]})]})]})]})}),s.jsxs("div",{className:"d-md-none",children:[t.carts.map(e=>s.jsx("div",{className:"card mb-3 shadow-sm border-0",children:s.jsxs("div",{className:"row g-0",children:[s.jsx("div",{className:"col-4 position-relative",children:s.jsx("div",{style:{width:"100%",height:"100%",minHeight:"120px",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:`url(${e.product.imageUrl||""})`},className:"rounded-start h-100 bg-light",children:!e.product.imageUrl&&s.jsx("span",{className:"d-flex position-absolute top-50 start-50 translate-middle text-secondary small",children:"無圖"})})}),s.jsx("div",{className:"col-8",children:s.jsxs("div",{className:"card-body py-2 px-3",children:[s.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[s.jsx("h5",{className:"card-title h6 mb-0 text-truncate",style:{maxWidth:"85%"},children:e.product.title}),s.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm p-1 lh-1",onClick:()=>o(e.id),children:s.jsx("small",{children:"x"})})]}),e.coupon&&s.jsxs("div",{className:"text-success small mb-2",children:["已套用優惠券：",e.coupon.title]}),s.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[s.jsxs("div",{className:"input-group input-group-sm w-auto",children:[s.jsx("select",{className:"form-select form-select-sm",value:e.qty,onChange:a=>i(e,Number(a.target.value)),style:{width:"60px"},children:[...Array(20)].map((a,l)=>s.jsx("option",{value:l+1,children:l+1},l+1))}),s.jsx("span",{className:"input-group-text",children:e.product.unit})]}),s.jsx("div",{className:"text-end",children:e.final_total!==e.total?s.jsxs(s.Fragment,{children:[s.jsxs("small",{className:"text-muted text-decoration-line-through d-block",children:["$",e.total]}),s.jsxs("span",{className:"text-success fw-bold",children:["$",e.final_total]})]}):s.jsxs("span",{className:"fw-bold",children:["$",e.total]})})]})]})})]})},e.id)),s.jsx("div",{className:"card shadow-sm border-0",children:s.jsxs("div",{className:"card-body",children:[s.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[s.jsx("span",{className:"h5 mb-0",children:"總計"}),s.jsxs("span",{className:"h5 mb-0",children:["$",t.total]})]}),t.final_total!==t.total&&s.jsxs("div",{className:"d-flex justify-content-between align-items-center text-success",children:[s.jsx("span",{children:"折扣價"}),s.jsxs("span",{className:"fw-bold",children:["$",t.final_total]})]})]})})]})]}):s.jsx("div",{className:"alert alert-secondary text-center",children:"購物車內目前沒有商品"})]})]})};export{y as default};
