import{r as d,j as e,e as j}from"./index-MsTtMQ9-.js";import{g as m,c as p,b as g,u as f}from"./cartService-DkqoA9Y1.js";import{S as n}from"./sweetalert2.esm.all-BQxta0Da.js";const C=()=>{const[a,i]=d.useState({}),[o,s]=d.useState(!1);d.useEffect(()=>{c()},[]);const c=async()=>{s(!0);try{const t=await m();i(t.data)}catch(t){n.fire({icon:"error",title:"取得購物車失敗",text:t.response?.data?.message||"發生錯誤"})}finally{s(!1)}},x=async(t,r)=>{s(!0);try{await f(t.id,t.product_id,r),c()}catch(l){n.fire({icon:"error",title:"更新購物車失敗",text:l.response?.data?.message||"發生錯誤"}),s(!1)}},h=async t=>{s(!0);try{await g(t),c(),n.fire({icon:"success",title:"已移除商品",showConfirmButton:!1,timer:1500})}catch(r){n.fire({icon:"error",title:"移除商品失敗",text:r.response?.data?.message||"發生錯誤"}),s(!1)}},u=async()=>{s(!0);try{await p(),c(),n.fire({icon:"success",title:"已清空購物車",showConfirmButton:!1,timer:1500})}catch(t){n.fire({icon:"error",title:"清空購物車失敗",text:t.response?.data?.message||"發生錯誤"}),s(!1)}};return e.jsxs(e.Fragment,{children:[o&&e.jsx(j,{}),e.jsxs("div",{className:"container mt-4",children:[e.jsx("div",{className:"d-flex justify-content-between mb-4",children:e.jsx("h2",{children:"購物車列表"})}),a.carts&&a.carts.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"text-end mb-3",children:e.jsx("button",{className:"btn btn-outline-danger",onClick:u,children:"清空購物車"})}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{children:"圖片"}),e.jsx("th",{children:"品名"}),e.jsx("th",{style:{width:"150px"},children:"數量/單位"}),e.jsx("th",{className:"text-end",children:"單價"})]})}),e.jsx("tbody",{children:a.carts.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>h(t.id),children:"x"})}),e.jsx("td",{children:e.jsx("div",{style:{width:"80px",height:"80px",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:`url(${t.product.imageUrl||""})`},className:"rounded bg-light border",children:!t.product.imageUrl&&e.jsx("span",{className:"d-flex w-100 h-100 justify-content-center align-items-center text-secondary small",children:"無圖"})})}),e.jsxs("td",{children:[t.product.title,t.coupon&&e.jsxs("div",{className:"text-success small",children:["已套用優惠券：",t.coupon.title]})]}),e.jsx("td",{children:e.jsxs("div",{className:"input-group input-group-sm",children:[e.jsx("select",{className:"form-select",value:t.qty,onChange:r=>x(t,Number(r.target.value)),children:[...Array(20)].map((r,l)=>e.jsx("option",{value:l+1,children:l+1},l+1))}),e.jsx("span",{className:"input-group-text",id:"basic-addon2",children:t.product.unit})]})}),e.jsx("td",{className:"text-end",children:t.final_total!==t.total?e.jsxs(e.Fragment,{children:[e.jsxs("small",{className:"text-muted text-decoration-line-through",children:["$",t.total]}),e.jsx("br",{}),e.jsx("small",{className:"text-success",children:"折扣價："}),"$",t.final_total]}):`$${t.total}`})]},t.id))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-end",children:"總計"}),e.jsxs("td",{className:"text-end",children:["$",a.total]})]}),a.final_total!==a.total&&e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-end text-success",children:"折扣價"}),e.jsxs("td",{className:"text-end text-success",children:["$",a.final_total]})]})]})]})})]}):e.jsx("div",{className:"alert alert-secondary text-center",children:"購物車內目前沒有商品"})]})]})};export{C as default};
