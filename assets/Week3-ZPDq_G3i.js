import{j as e,r as c,M as L,e as G}from"./index-B7icCtW5.js";import{g as H,c as R,u as J,d as K}from"./productService-DI_3pMNF.js";import{S as d}from"./sweetalert2.esm.all-BQxta0Da.js";const Q=({pageInfo:r,onPageChange:b})=>e.jsx("nav",{"aria-label":"Page navigation",children:e.jsxs("ul",{className:"pagination justify-content-center",children:[e.jsx("li",{className:`page-item ${!r.has_pre&&"disabled"}`,children:e.jsx("a",{className:"page-link",href:"/",onClick:l=>{l.preventDefault(),r.has_pre&&(b(r.current_page-1),window.scrollTo(0,0))},children:"«"})}),Array.from({length:r.total_pages}).map((l,u)=>e.jsx("li",{className:`page-item ${r.current_page===u+1&&"active"}`,children:e.jsx("a",{className:"page-link",href:"/",onClick:s=>{s.preventDefault(),b(u+1),window.scrollTo(0,0)},children:u+1})},u)),e.jsx("li",{className:`page-item ${!r.has_next&&"disabled"}`,children:e.jsx("a",{className:"page-link",href:"/",onClick:l=>{l.preventDefault(),r.has_next&&(b(r.current_page+1),window.scrollTo(0,0))},children:"»"})})]})}),S={title:"",category:"",origin_price:0,price:0,unit:"",description:"",content:"",is_enabled:1,imageUrl:"",imagesUrl:[]},Z=()=>{const[r,b]=c.useState([]),[l,u]=c.useState({}),[s,m]=c.useState(S),[w,k]=c.useState(!1),[_,n]=c.useState(!1),C=c.useRef(null),M=c.useRef(null),g=c.useRef(null),j=c.useRef(null);c.useEffect(()=>{g.current=new L(C.current,{backdrop:"static"}),j.current=new L(M.current,{backdrop:"static"}),h()},[]);const h=async(a=1)=>{n(!0);try{const t=await H(a);b(t.products),u(t.pagination)}catch(t){d.fire({icon:"error",title:"取得產品失敗",text:t.response?.data?.message||"發生錯誤"})}finally{n(!1)}},I=async()=>{n(!0);try{const a={...s,origin_price:Number(s.origin_price),price:Number(s.price)};await R(a),x(),await h(l.current_page),d.fire({icon:"success",title:"新增成功"})}catch(a){d.fire({icon:"error",title:"新增失敗",text:a.response?.data?.message||"發生錯誤"})}finally{n(!1)}},A=async()=>{n(!0);try{const t=["電子產品","衣服","書籍","家具","玩具"],o=["超級","精緻","豪華","實用","時尚","復古","智能","環保","限量","經典"],p=["手錶","外套","小說","椅子","機器人","耳機","背包","桌子","公仔","手機"],N=Array.from({length:20}).map((y,v)=>{const z=t[Math.floor(Math.random()*t.length)],P=o[Math.floor(Math.random()*o.length)],F=p[Math.floor(Math.random()*p.length)],D=Math.floor(Math.random()*9e3)+100;return{title:`${P}${F} ${Math.floor(Math.random()*1e3)}`,category:z,origin_price:D+Math.floor(Math.random()*1e3),price:D,unit:"個",description:`這是一個${P}的${F}，非常適合您。`,content:`產品編號：${Date.now()}-${v}`,is_enabled:1,imageUrl:`https://picsum.photos/300/300?random=${Math.random()}`,imagesUrl:[]}});let $=0;for(const y of N)try{await R(y),$++}catch(v){console.error("Failed to create fake product:",y.title,v)}finally{}await h(l.current_page),d.fire({icon:"success",title:"假資料建立完成",text:`成功建立 ${$} / 20 筆產品`})}catch(a){d.fire({icon:"error",title:"建立假資料失敗",text:a.message||"發生錯誤"})}finally{n(!1)}},T=async()=>{n(!0);try{const a={...s,origin_price:Number(s.origin_price),price:Number(s.price)};await J(s.id,a),x(),await h(l.current_page),d.fire({icon:"success",title:"更新成功"})}catch(a){d.fire({icon:"error",title:"更新失敗",text:a.response?.data?.message||"發生錯誤"})}finally{n(!1)}},W=async()=>{n(!0);try{await K(s.id),f(),r.length===1&&l.current_page>1?await h(l.current_page-1):await h(l.current_page),d.fire({icon:"success",title:"刪除成功"})}catch(a){d.fire({icon:"error",title:"刪除失敗",text:a.response?.data?.message||"發生錯誤"})}finally{n(!1)}},U=(a,t)=>{a==="create"?(m(S),k(!0)):(m({...t}),k(!1)),g.current.show()},E=a=>{m(a),j.current.show()},x=()=>{g.current.hide()},f=()=>{j.current.hide()},i=a=>{const{name:t,value:o,type:p,checked:N}=a.target;m({...s,[t]:p==="checkbox"?N?1:0:o})},B=(a,t)=>{const o=[...s.imagesUrl];o[a]=t,m({...s,imagesUrl:o})},O=()=>{const a=[...s.imagesUrl||[],""];m({...s,imagesUrl:a})},q=()=>{const a=[...s.imagesUrl||[]];a.pop(),m({...s,imagesUrl:a})};return e.jsxs(e.Fragment,{children:[_&&e.jsx(G,{}),e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-4",children:[e.jsx("h2",{children:"產品列表"}),e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-primary me-2",onClick:()=>U("create"),children:"建立產品"}),e.jsx("button",{className:"btn btn-outline-secondary ",onClick:A,disabled:_,children:"建立產品(假資料)"})]})]}),e.jsx("div",{className:"row mt-4",children:r.map(a=>e.jsx("div",{className:"col-md-6 mb-6",children:e.jsxs("div",{className:"card h-100 shadow-sm border-0",children:[e.jsxs("div",{className:"position-relative",style:{height:"250px",overflow:"hidden"},children:[e.jsx("img",{src:a.imageUrl,className:"card-img-top h-100 w-100",style:{objectFit:"cover"},alt:a.title}),!a.is_enabled&&e.jsx("div",{className:"position-absolute top-0 start-0 w-100 h-100 bg-dark bg-opacity-50 d-flex align-items-center justify-content-center",children:e.jsx("span",{className:"text-white fw-bold border border-white px-3 py-1 rounded",children:"未啟用"})})]}),e.jsxs("div",{className:"card-body d-flex flex-column",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsx("h5",{className:"card-title text-truncate mb-0",style:{maxWidth:"70%"},children:a.title}),e.jsx("span",{className:"badge bg-secondary",children:a.category})]}),e.jsx("p",{className:"card-text text-muted small mb-auto",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:a.description}),e.jsx("div",{className:"d-flex justify-content-between align-items-center mt-3",children:e.jsxs("div",{children:[a.origin_price!==a.price&&e.jsxs("small",{className:"text-decoration-line-through text-muted me-2",children:["$",a.origin_price]}),e.jsxs("span",{className:"fw-bold text-danger",children:["$",a.price]})]})})]}),e.jsxs("div",{className:"card-footer bg-transparent border-top-0 d-flex justify-content-between pb-3",children:[e.jsx("button",{type:"button",className:"btn btn-outline-primary w-50 me-2",onClick:()=>U("edit",a),children:"編輯"}),e.jsx("button",{type:"button",className:"btn btn-outline-danger w-50",onClick:()=>E(a),children:"刪除"})]})]})},a.id))}),e.jsx(Q,{pageInfo:l,onPageChange:h}),e.jsx("div",{id:"productModal",ref:C,className:"modal fade",tabIndex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-xl",children:e.jsxs("div",{className:"modal-content border-0",children:[e.jsxs("div",{className:"modal-header bg-dark text-white",children:[e.jsx("h5",{id:"productModalLabel",className:"modal-title",children:w?"新增產品":"編輯產品"}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:x,"aria-label":"Close"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-sm-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"imageUrl",className:"form-label",children:"主要圖片"}),e.jsx("input",{name:"imageUrl",type:"text",className:"form-control",placeholder:"請輸入圖片連結",value:s.imageUrl,onChange:i}),e.jsx("img",{className:"img-fluid mt-3",src:s.imageUrl,alt:""})]}),e.jsx("h3",{className:"mb-3",children:"多圖新增"}),Array.isArray(s.imagesUrl)&&s.imagesUrl.map((a,t)=>e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["圖片網址 ",t+1]}),e.jsx("input",{type:"text",className:"form-control",placeholder:"請輸入圖片連結",value:a,onChange:o=>B(t,o.target.value)}),a&&e.jsx("img",{className:"img-fluid mt-3 mb-3",src:a,alt:""})]},t)),e.jsxs("div",{className:"d-flex justify-content-between",children:[(!s.imagesUrl||s.imagesUrl.length===0||s.imagesUrl[s.imagesUrl.length-1])&&e.jsx("button",{className:"btn btn-outline-primary btn-sm w-100 me-2",onClick:O,children:"新增圖片"}),s.imagesUrl&&s.imagesUrl.length>0&&e.jsx("button",{className:"btn btn-outline-danger btn-sm w-100",onClick:q,children:"刪除圖片"})]})]}),e.jsxs("div",{className:"col-sm-8",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"title",className:"form-label",children:"標題"}),e.jsx("input",{id:"title",name:"title",type:"text",className:"form-control",placeholder:"請輸入標題",value:s.title,onChange:i})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"mb-3 col-md-6",children:[e.jsx("label",{htmlFor:"category",className:"form-label",children:"分類"}),e.jsx("input",{id:"category",name:"category",type:"text",className:"form-control",placeholder:"請輸入分類",value:s.category,onChange:i})]}),e.jsxs("div",{className:"mb-3 col-md-6",children:[e.jsx("label",{htmlFor:"unit",className:"form-label",children:"單位"}),e.jsx("input",{id:"unit",name:"unit",type:"text",className:"form-control",placeholder:"請輸入單位",value:s.unit,onChange:i})]})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"mb-3 col-md-6",children:[e.jsx("label",{htmlFor:"origin_price",className:"form-label",children:"原價"}),e.jsx("input",{id:"origin_price",name:"origin_price",type:"number",className:"form-control",placeholder:"請輸入原價",value:s.origin_price,onChange:i})]}),e.jsxs("div",{className:"mb-3 col-md-6",children:[e.jsx("label",{htmlFor:"price",className:"form-label",children:"售價"}),e.jsx("input",{id:"price",name:"price",type:"number",className:"form-control",placeholder:"請輸入售價",value:s.price,onChange:i})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"description",className:"form-label",children:"產品描述"}),e.jsx("textarea",{id:"description",name:"description",className:"form-control",placeholder:"請輸入產品描述",value:s.description,onChange:i})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"content",className:"form-label",children:"說明內容"}),e.jsx("textarea",{id:"content",name:"content",className:"form-control",placeholder:"請輸入說明內容",value:s.content,onChange:i})]}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{id:"is_enabled",name:"is_enabled",className:"form-check-input",type:"checkbox",checked:!!s.is_enabled,onChange:i}),e.jsx("label",{className:"form-check-label",htmlFor:"is_enabled",children:"是否啟用"})]})})]})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:x,children:"取消"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:w?I:T,children:"確認"})]})]})})}),e.jsx("div",{id:"deleteModal",ref:M,className:"modal fade",tabIndex:"-1","aria-labelledby":"deleteModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content border-0",children:[e.jsxs("div",{className:"modal-header bg-danger text-white",children:[e.jsx("h5",{id:"deleteModalLabel",className:"modal-title",children:e.jsx("span",{children:"刪除產品"})}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:f,"aria-label":"Close"})]}),e.jsxs("div",{className:"modal-body",children:["是否刪除 ",e.jsx("strong",{className:"text-danger",children:s.title})," (刪除後將無法恢復)。"]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:f,children:"取消"}),e.jsx("button",{type:"button",className:"btn btn-danger",onClick:W,children:"確認刪除"})]})]})})})]})]})};export{Z as default};
