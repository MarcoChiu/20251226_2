import{r as o,f as w,j as t,e as N,g as m}from"./index-DVyv32AZ.js";import{g as _,u as C,c as M,d as $}from"./productService-BQcXcqnr.js";import{P as D}from"./Pagination-nYRCMy6R.js";import{P as v,a as R}from"./ProductDModal-ffJrle5R.js";import{P as k}from"./ProductCard-CPm-Bhoa.js";import{s as l}from"./sweetAlert-D4ArfHHU.js";import{s as S}from"./scrollTo-BJ3PFdU1.js";const W=()=>{const[p,f]=o.useState([]),[r,h]=o.useState({}),[y,a]=o.useState(!1),c=o.useRef(null),u=o.useRef(null),d=w();o.useEffect(()=>{n()},[]);const n=async(e=1,s=!0)=>{a(!0);try{const i=await _(e);f(i.products),h(i.pagination),s&&S()}catch(i){l("error","取得產品失敗",i.response?.data?.message||"發生錯誤")}finally{a(!1)}},P=async e=>{a(!0);try{const s={...e,origin_price:Number(e.origin_price),price:Number(e.price)};await M(s),c.current.hide(),await n(r.current_page,!1),d(m({success:!0,message:`新增 ${e.title} 成功`,type:"success",title:"系統通知"}))}catch(s){l("error","新增失敗",s.response?.data?.message||"發生錯誤")}finally{a(!1)}},x=async e=>{a(!0);try{const s={...e,origin_price:Number(e.origin_price),price:Number(e.price)};await C(e.id,s),c.current.hide(),await n(r.current_page,!1),d(m({success:!0,message:`更新 ${e.title} 成功`,type:"primary",title:"系統通知"}))}catch(s){l("error","更新失敗",s.response?.data?.message||"發生錯誤")}finally{a(!1)}},b=async e=>{a(!0);try{await $(e.id),u.current.hide(),p.length===1&&r.current_page>1?await n(r.current_page-1,!1):await n(r.current_page,!1),d(m({success:!0,message:`刪除 ${e.title} 成功`,type:"danger",title:"系統通知"}))}catch(s){l("error","刪除失敗",s.response?.data?.message||"發生錯誤")}finally{a(!1)}},g=(e,s)=>{c.current.show(e,s)},j=e=>{u.current.show(e)};return t.jsxs(t.Fragment,{children:[y&&t.jsx(N,{}),t.jsxs("div",{className:"container mt-4",children:[t.jsxs("div",{className:"d-flex justify-content-between mb-4",children:[t.jsx("h2",{children:"產品列表"}),t.jsx("div",{children:t.jsx("button",{className:"btn btn-primary me-2",onClick:()=>g("create"),children:"建立產品"})})]}),t.jsx("div",{className:"row mt-4",children:p.map(e=>t.jsx("div",{className:"col-md-6 mb-6",children:t.jsxs(k,{product:e,showStatus:!0,children:[t.jsx("button",{type:"button",className:"btn btn-outline-primary w-50 me-2",onClick:()=>g("edit",e),children:"編輯"}),t.jsx("button",{type:"button",className:"btn btn-outline-danger w-50",onClick:()=>j(e),children:"刪除"})]})},e.id))}),t.jsx(D,{currentPage:r.current_page,totalPages:r.total_pages,onPageChange:n}),t.jsx(v,{ref:c,onCreate:P,onUpdate:x}),t.jsx(R,{ref:u,onDelete:b})]})]})};export{W as default};
