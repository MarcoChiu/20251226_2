import{h as P,a as T,A,r as n,M as U,j as e,e as D}from"./index-DVyv32AZ.js";import{a as y,s as t}from"./sweetAlert-D4ArfHHU.js";const w=async u=>{const h=P(),m=new FormData;return m.append("file-to-upload",u),(await T.post(A.uploadImage,m,{headers:{"Content-Type":"multipart/form-data",Authorization:h}})).data},C={title:"",category:"",origin_price:0,price:0,unit:"",description:"",content:"",is_enabled:1,imageUrl:"",imagesUrl:[],salefrom:"",saleto:""},L=n.forwardRef(({onUpdate:u,onCreate:h},m)=>{const[a,o]=n.useState(C),[c,b]=n.useState(!1),[x,f]=n.useState(!1),N=n.useRef(null),p=n.useRef(null),j=n.useRef(null);n.useEffect(()=>{p.current=new U(N.current,{backdrop:"static"})},[]),n.useImperativeHandle(m,()=>({show:(s,r)=>{s==="create"?(o(C),b(!0)):(o({...r}),b(!1)),j.current&&(j.current.value=""),p.current.show()},hide:()=>{p.current.hide()}}));const i=s=>{const{name:r,value:l,type:d,checked:g}=s.target;o({...a,[r]:d==="checkbox"?g?1:0:l})},I=(s,r)=>{const l=[...a.imagesUrl];l[s]=r,o({...a,imagesUrl:l})},k=()=>{const s=[...a.imagesUrl||[],""];o({...a,imagesUrl:s})},F=()=>{const s=[...a.imagesUrl||[]];s.pop(),o({...a,imagesUrl:s})},v=s=>{if(!["image/jpeg","image/png"].includes(s.type))return t("error","格式錯誤","僅限使用 jpg、jpeg 與 png 格式"),!1;const l=3;return s.size/1024/1024>l?(t("error","檔案過大",`檔案大小限制為 ${l}MB 以下`),!1):!0},_=async s=>{const r=s.target.files[0];if(r){if(!v(r)){s.target.value="";return}f(!0);try{const l=await w(r);l.success?(o({...a,imageUrl:l.imageUrl}),y("success","圖片上傳成功")):t("error","圖片上傳失敗",l.message||"未知錯誤")}catch(l){t("error","圖片上傳錯誤",l.message||"發生錯誤")}finally{f(!1),s.target.value=""}}},M=async(s,r)=>{const l=r.target.files[0];if(l){if(!v(l)){r.target.value="";return}f(!0);try{const d=await w(l);if(d.success){const g=[...a.imagesUrl];g[s]=d.imageUrl,o({...a,imagesUrl:g}),y("success","圖片上傳成功")}else t("error","圖片上傳失敗",d.message||"未知錯誤")}catch(d){t("error","圖片上傳錯誤",d.message||"發生錯誤")}finally{f(!1),r.target.value=""}}},R=()=>{if(!a.title?.trim()){t("error","欄位必填","請填寫標題");return}if(!a.category?.trim()){t("error","欄位必填","請填寫分類");return}if(!a.unit?.trim()){t("error","欄位必填","請填寫單位");return}if(!a.origin_price||a.origin_price<=0){t("error","欄位必填","請填寫原價");return}if(!a.price||a.price<=0){t("error","欄位必填","請填寫售價");return}if(!a.description?.trim()){t("error","欄位必填","請填寫產品描述");return}if(!a.content?.trim()){t("error","欄位必填","請填寫說明內容");return}if(!a.salefrom||!a.saleto){t("error","欄位必填","請填寫販售日期起和販售日期迄");return}if(new Date(a.salefrom)>new Date(a.saleto)){t("error","日期錯誤","販售日期起不可以大於販售日期迄");return}c?h(a):u(a)};return e.jsx("div",{id:"productModal",ref:N,className:"modal fade",tabIndex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-xl",children:e.jsxs("div",{className:"modal-content border-0",children:[e.jsxs("div",{className:"modal-header bg-dark text-white",children:[e.jsx("h5",{id:"productModalLabel",className:"modal-title",children:c?"新增產品":"編輯產品"}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>p.current.hide(),"aria-label":"Close"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-sm-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"imageUrl",className:"form-label",children:"封面圖片"}),e.jsx("div",{className:"input-group mb-3",children:e.jsx("input",{name:"imageUrl",type:"text",className:"form-control",placeholder:"請輸入圖片連結",value:a.imageUrl,onChange:i})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"fileInput",className:"form-label",children:"或 上傳圖片"}),e.jsx("input",{type:"file",className:"form-control",id:"fileInput",ref:j,onChange:_,disabled:x})]}),a.imageUrl&&e.jsx("img",{className:"img-fluid mt-3",src:a.imageUrl,alt:""})]}),e.jsx("h3",{className:"mb-3",children:"產品圖片"}),Array.isArray(a.imagesUrl)&&a.imagesUrl.map((s,r)=>e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["圖片網址 ",r+1]}),e.jsx("input",{type:"text",className:"form-control mb-2",placeholder:"請輸入圖片連結",value:s,onChange:l=>I(r,l.target.value)}),e.jsx("input",{type:"file",className:"form-control",onChange:l=>M(r,l),disabled:x}),s&&e.jsx("img",{className:"img-fluid mt-3 mb-3",src:s,alt:""})]},r)),e.jsxs("div",{className:"d-flex justify-content-between",children:[(!a.imagesUrl||a.imagesUrl.length===0||a.imagesUrl[a.imagesUrl.length-1])&&e.jsx("button",{className:"btn btn-outline-primary btn-sm w-100 me-2",onClick:k,children:"新增圖片"}),a.imagesUrl&&a.imagesUrl.length>0&&e.jsx("button",{className:"btn btn-outline-danger btn-sm w-100",onClick:F,children:"刪除圖片"})]})]}),e.jsxs("div",{className:"col-sm-8",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"title",className:"form-label",children:"標題"}),e.jsx("input",{id:"title",name:"title",type:"text",className:"form-control",placeholder:"請輸入標題",value:a.title,onChange:i})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"mb-3 col-md-6",children:[e.jsx("label",{htmlFor:"category",className:"form-label",children:"分類"}),e.jsx("input",{id:"category",name:"category",type:"text",className:"form-control",placeholder:"請輸入分類",value:a.category,onChange:i})]}),e.jsxs("div",{className:"mb-3 col-md-6",children:[e.jsx("label",{htmlFor:"unit",className:"form-label",children:"單位"}),e.jsx("input",{id:"unit",name:"unit",type:"text",className:"form-control",placeholder:"請輸入單位",value:a.unit,onChange:i})]})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"mb-3 col-md-6",children:[e.jsx("label",{htmlFor:"origin_price",className:"form-label",children:"原價"}),e.jsx("input",{id:"origin_price",name:"origin_price",type:"number",className:"form-control",placeholder:"請輸入原價",min:"0",value:a.origin_price,onChange:i})]}),e.jsxs("div",{className:"mb-3 col-md-6",children:[e.jsx("label",{htmlFor:"price",className:"form-label",children:"售價"}),e.jsx("input",{id:"price",name:"price",type:"number",className:"form-control",placeholder:"請輸入售價",min:"0",value:a.price,onChange:i})]})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"mb-3 col-md-6",children:[e.jsx("label",{htmlFor:"salefrom",className:"form-label",children:"販售日期起(自訂欄位)"}),e.jsx("input",{id:"salefrom",name:"salefrom",type:"date",className:"form-control",value:a.salefrom||"",onChange:i})]}),e.jsxs("div",{className:"mb-3 col-md-6",children:[e.jsx("label",{htmlFor:"saleto",className:"form-label",children:"販售日期迄(自訂欄位)"}),e.jsx("input",{id:"saleto",name:"saleto",type:"date",className:"form-control",value:a.saleto||"",onChange:i})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"description",className:"form-label",children:"產品描述"}),e.jsx("textarea",{id:"description",name:"description",className:"form-control",placeholder:"請輸入產品描述",value:a.description,onChange:i,rows:10})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"content",className:"form-label",children:"說明內容"}),e.jsx("textarea",{id:"content",name:"content",className:"form-control",placeholder:"請輸入說明內容",value:a.content,onChange:i,rows:10})]}),e.jsx("div",{className:"row"}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{id:"is_enabled",name:"is_enabled",className:"form-check-input",type:"checkbox",checked:!!a.is_enabled,onChange:i}),e.jsx("label",{className:"form-check-label",htmlFor:"is_enabled",children:"是否啟用"})]})})]})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>p.current.hide(),children:"取消"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:R,children:"確認"})]}),x&&e.jsx(D,{})]})})})}),z=n.forwardRef(({onDelete:u},h)=>{const[m,a]=n.useState(null),o=n.useRef(null),c=n.useRef(null);return n.useEffect(()=>{c.current=new U(o.current,{backdrop:"static"})},[]),n.useImperativeHandle(h,()=>({show:b=>{a(b),c.current.show()},hide:()=>{c.current.hide()}})),e.jsx("div",{id:"deleteModal",ref:o,className:"modal fade",tabIndex:"-1","aria-labelledby":"deleteModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content border-0",children:[e.jsxs("div",{className:"modal-header bg-danger text-white",children:[e.jsx("h5",{id:"deleteModalLabel",className:"modal-title",children:e.jsx("span",{children:"刪除產品"})}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>c.current.hide(),"aria-label":"Close"})]}),e.jsxs("div",{className:"modal-body",children:["是否刪除 ",e.jsx("strong",{className:"text-danger",children:m?.title})," (刪除後將無法恢復)。"]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>c.current.hide(),children:"取消"}),e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>u(m),children:"確認刪除"})]})]})})})});export{L as P,z as a};
